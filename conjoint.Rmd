---
title: "Ratings Based Product Conjoint Analysis"
author: "Njabulo Hlabangana"
date: '2022-08-06'
output: html_document
---


```{r setup, include=FALSE,echo = FALSE,warning=FALSE,message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Introduction
Conjoint analysis is one of the most powerful and widely used tool in market research. Almost every major market research consulting firm has professionals capable of conducting conjoint analysis. It is basically a statistical technique used to determine consumer preferences for products or services. It uses a de-compositional approach that breaks down a product into its salient features known as **attributes**.  Attributes in this case refer to the key characteristics of a product/service that consumers use to make their purchase decisions. The consumer preferences are obtained using different kinds of surveys but of late online surveys are the main tool used. 

In this exercise I use ice cream as an example. The attributes used are Flavor, Packaging, Organic (Whether its organic or not) and Light(Whether its Low fat or not). Each attribute has what are known as **levels** which are essentially different amounts or classes of that particular attribute. For instance, in the case of the icecream example, the attribute Flavor has Mango, Raspberry, Chocolate, Vanilla and Strawberry as its levels. A particular combination of attribute levels constitute a **product profile** e.g a low fat organic vanilla cone ice cream.

The aim of this study is to determine 1) the importance of each attribute in the consumer decision making process 2) which product profile is the most preferred in the market 3) predict the ratings of other product profiles that were not part of the survey 
4) estimate the market shares of some selected products.



```{r, message=FALSE, warning=FALSE}
library(radiant) # used to access the conjoint function
library(tidyverse) #used for manipulation of data frames
```


## Data

In this data set, 15 consumers where asked to each rate 10 ice cream profiles on a scale of 1 to 10 - 1 being the least and 10 being the best.Below is a look at the first 10 rows of the dataframe.

```{r}
setwd('/Users/hlaba/Documents/Custom Office Templates/BA')
icecream <- read.csv('Ice Cream.csv')
head(icecream,10)
```
## Conjoint Analysis
 The conjoint function of the radiant package is used to model respondent preferences based on the ratings given. The summary of output is given below.
```{r}
conjoint_allrespondents <- conjoint(icecream, rvar = "Rating", evar = c("Flavor","Packaging","Light","Organic")) 
summary(conjoint_allrespondents)
```
The output helps to answer the first question about attribute importance. This is given as weights given to each attribute by the respondent in the decision making process. Flavour - with an importance weight of 59 % is by far the most important of the four attributes, followed by Light(low fat or not) with an importance weight of 18.7 %, then Organic with a weight of 12 %. The least important of the four is packaging with a weight of 9.6 %.

## Part-worth (utility) plots

Part-worth plots are used to visualize the estimated utilities (satisfaction derived by the consumer) of each factor level. Total utility for each product profile is the sum total of the utilities of its constituent attribute levels. Based on the part-worth plot below, it is clear that the most preferred profile is a Full fat organic Mango ice cream in a cone.

```{r}
plot(conjoint_allrespondents)
```



```{r}
flavor <- unique(icecream$Flavor)
packaging <- unique(icecream$Packaging)
light <- unique(icecream$Light)
organic <- unique(icecream$Organic)
all_profiles <- expand.grid(flavor,packaging,light,organic)
attr <- c("Flavor", "Packaging", "Light","Organic")
all_profiles <-`colnames<-`(all_profiles,attr)

print(all_profiles)
```
##Predicting Consumer Preferences 

The radiant package comes with the function to predict ratings of products including those that were not part of the study based on the study findings. The outcome of the prediction of all possible profiles is shown below. The product profiles are shown in descending order of predicted rating. In a line with our previous finding, the combination of Mango, Cone, No low fat and organic is predicted to have the highest utility. 

```{r}
predictions <- predict(conjoint_allrespondents, all_profiles) %>% arrange(desc(Prediction))
predictions
```


## Conjoint By Respondent

So far the analysis conducted was based on the average rating of product profiles by all respondents. This part seeks to ascertain the rating per individual with the aim to predict how each respondent would rate profile that may not have been part of the study. This is done by adding the "by = respondent" argument in the conjoint function.

```{r}
conjoint_by_respondent <- conjoint(icecream, rvar = "Rating", evar = c("Flavor","Packaging","Light","Organic"), by = "Respondent")

selected_profiles <- slice_head(predictions,n = 5) # selecting top 5 predicted profiles

selected_profile_ratings <- predict(conjoint_by_respondent, selected_profiles)# ascertaining predicted ratings of the top five for each respondent 

```


```{r, message=FALSE,warning=FALSE}
most_preferred_by_respondent <-  selected_profile_ratings %>% 
  group_by(Respondent) %>% 
  mutate(ranking = rank(Prediction)) %>% arrange(Respondent,desc(ranking)) %>% filter(ranking == 5)

print(most_preferred_by_respondent)
```


```{r, message=FALSE, warning=FALSE}
market_share <- most_preferred_by_respondent[-1] %>% 
  group_by(Flavor, Packaging, Light, Organic) %>% 
  summarise(count = n(), market_share_percentage = round(count*100/14)) %>%  
  arrange(desc(count))

market_share
```


